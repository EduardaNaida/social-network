{"ast":null,"code":"import _asyncToGenerator from\"/Users/eduardanaida/Documents/GitHub/social-network/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/Users/eduardanaida/Documents/GitHub/social-network/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/eduardanaida/Documents/GitHub/social-network/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/eduardanaida/Documents/GitHub/social-network/node_modules/@babel/runtime/regenerator/index.js\";import{usersAPI}from\"../api/api\";import{updateObjectInArray}from\"../utils/objectHelper\";var FOLLOW=\"USER/FOLLOW\";var UNFOLLOW=\"USER/UNFOLLOW\";var SET_USERS=\"USER/SET_USERS\";var SET_CURRENT_PAGE=\"USER/SET_CURRENT_PAGE\";var SET_TOTAL_COUNT='USER/SET_TOTAL_COUNT';var TOGGLE_IS_FETCHING='USER/TOGGLE_IS_FETCHING';var TOGGLE_IS_FOLLOWING='USER/TOGGLE_IS_FOLLOWING';var initialState={users:[],pageSize:10,totalUsersCount:0,currentPage:1,isFetching:false,followingInProgress:[]};export var usersReducer=function usersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case FOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userID,\"id\",{followed:true})});case UNFOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userID,\"id\",{followed:false})});case SET_USERS:return _objectSpread(_objectSpread({},state),{},{users:[].concat(_toConsumableArray(action.users),_toConsumableArray(state.users))});case SET_CURRENT_PAGE:return _objectSpread(_objectSpread({},state),{},{currentPage:action.currentPage});case SET_TOTAL_COUNT:return _objectSpread(_objectSpread({},state),{},{totalUsersCount:action.count});case TOGGLE_IS_FETCHING:return _objectSpread(_objectSpread({},state),{},{isFetching:action.isFetching});case TOGGLE_IS_FOLLOWING:return _objectSpread(_objectSpread({},state),{},{followingInProgress:action.followingInProgress?[].concat(_toConsumableArray(state.followingInProgress),[action.userId]):state.followingInProgress.filter(function(id){return id!==action.userId;})});default:return state;}};export var followSuccess=function followSuccess(userID){return{type:FOLLOW,userID:userID};};export var unfollowSuccess=function unfollowSuccess(userID){return{type:UNFOLLOW,userID:userID};};export var setUsers=function setUsers(users){return{type:SET_USERS,users:users};};export var setCurrentPage=function setCurrentPage(currentPage){return{type:SET_CURRENT_PAGE,currentPage:currentPage};};export var setTotalCount=function setTotalCount(totalUsersCount){return{type:SET_TOTAL_COUNT,count:totalUsersCount};};export var setIsFetching=function setIsFetching(isFetching){return{type:TOGGLE_IS_FETCHING,isFetching:isFetching};};export var setIsFollowing=function setIsFollowing(followingInProgress,userId){return{type:TOGGLE_IS_FOLLOWING,followingInProgress:followingInProgress,userId:userId};};export var requestUser=function requestUser(page,pageSize){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(setCurrentPage(page));dispatch(setIsFetching(true));_context.next=4;return usersAPI.getUsersData(page,pageSize);case 4:response=_context.sent;dispatch(setIsFetching(false));dispatch(setUsers(response.items));dispatch(setTotalCount(response.totalCount));case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};var followUnfollowFlow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,userId,apiMethod,actionCreator){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch(setIsFollowing(true,userId));_context2.next=3;return apiMethod(userId);case 3:response=_context2.sent;if(response.resultCode===0){dispatch(actionCreator(userId));}dispatch(setIsFollowing(false,userId));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function followUnfollowFlow(_x2,_x3,_x4,_x5){return _ref2.apply(this,arguments);};}();export var unfollow=function unfollow(userId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return followUnfollowFlow(dispatch,userId,usersAPI.unfollowUsers.bind(usersAPI),unfollowSuccess);case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x6){return _ref3.apply(this,arguments);};}();};export var follow=function follow(userId){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return followUnfollowFlow(dispatch,userId,usersAPI.followUsers.bind(usersAPI),followSuccess);case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x7){return _ref4.apply(this,arguments);};}();};","map":{"version":3,"sources":["/Users/eduardanaida/Documents/GitHub/social-network/src/redux/usersReducer.ts"],"names":["usersAPI","updateObjectInArray","FOLLOW","UNFOLLOW","SET_USERS","SET_CURRENT_PAGE","SET_TOTAL_COUNT","TOGGLE_IS_FETCHING","TOGGLE_IS_FOLLOWING","initialState","users","pageSize","totalUsersCount","currentPage","isFetching","followingInProgress","usersReducer","state","action","type","userID","followed","count","userId","filter","id","followSuccess","unfollowSuccess","setUsers","setCurrentPage","setTotalCount","setIsFetching","setIsFollowing","requestUser","page","dispatch","getUsersData","response","items","totalCount","followUnfollowFlow","apiMethod","actionCreator","resultCode","unfollow","unfollowUsers","bind","follow","followUsers"],"mappings":"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","sourcesContent":["import {ResponseUserType, usersAPI} from \"../api/api\";\nimport {Dispatch} from \"redux\";\nimport {updateObjectInArray} from \"../utils/objectHelper\";\n\nexport type UsersReducersActionType =\n  | FollowType\n  | UnFollowType\n  | ReturnType<typeof setUsers>\n  | ReturnType<typeof setCurrentPage>\n  | ReturnType<typeof setTotalCount>\n  | ReturnType<typeof setIsFetching>\n  | ReturnType<typeof setIsFollowing>\n\ntype FollowType = ReturnType<typeof followSuccess>\ntype UnFollowType = ReturnType<typeof unfollowSuccess>\n\nconst FOLLOW = \"USER/FOLLOW\";\nconst UNFOLLOW = \"USER/UNFOLLOW\";\nconst SET_USERS = \"USER/SET_USERS\";\nconst SET_CURRENT_PAGE = \"USER/SET_CURRENT_PAGE\";\nconst SET_TOTAL_COUNT = 'USER/SET_TOTAL_COUNT';\nconst TOGGLE_IS_FETCHING = 'USER/TOGGLE_IS_FETCHING';\nconst TOGGLE_IS_FOLLOWING = 'USER/TOGGLE_IS_FOLLOWING';\n\nexport type UsersData = {\n  id: number,\n  name: string\n  followed: boolean\n  photos: {\n    small: string,\n    large: string\n  }\n}\n\nexport type UserPropsType = {\n  users: Array<UsersData>,\n  pageSize: number,\n  totalUsersCount: number,\n  currentPage: number,\n  isFetching: boolean,\n  followingInProgress: Array<any>\n}\n\nconst initialState: UserPropsType = {\n  users: [],\n  pageSize: 10,\n  totalUsersCount: 0,\n  currentPage: 1,\n  isFetching: false,\n  followingInProgress: []\n}\n\nexport const usersReducer = (state: UserPropsType = initialState, action: UsersReducersActionType): UserPropsType => {\n\n  switch (action.type) {\n    case FOLLOW:\n      return {\n        ...state,\n        users: updateObjectInArray(state.users, action.userID, \"id\", {followed: true})\n      }\n    case UNFOLLOW:\n      return {\n        ...state,\n        users: updateObjectInArray(state.users, action.userID, \"id\", {followed: false})\n      }\n\n    case SET_USERS:\n      return {\n        ...state,\n        users: [...action.users, ...state.users]\n      }\n\n    case SET_CURRENT_PAGE:\n      return {\n        ...state,\n        currentPage: action.currentPage\n      }\n    case SET_TOTAL_COUNT:\n      return {\n        ...state,\n        totalUsersCount: action.count\n      }\n    case TOGGLE_IS_FETCHING:\n      return {\n        ...state,\n        isFetching: action.isFetching\n      }\n    case TOGGLE_IS_FOLLOWING:\n      return {\n        ...state,\n        followingInProgress: action.followingInProgress\n          ? [...state.followingInProgress, action.userId]\n          : state.followingInProgress.filter(id => id !== action.userId)\n      }\n    default:\n      return state;\n  }\n};\n\nexport const followSuccess = (userID: number) => {\n  return {\n    type: FOLLOW,\n    userID: userID\n  } as const\n}\n\nexport const unfollowSuccess = (userID: number) => {\n  return {\n    type: UNFOLLOW,\n    userID: userID\n  } as const\n}\n\nexport const setUsers = (users: Array<UsersData>) => {\n  return {\n    type: SET_USERS,\n    users: users\n  } as const\n}\n\nexport const setCurrentPage = (currentPage: number) => {\n  return {\n    type: SET_CURRENT_PAGE,\n    currentPage: currentPage\n  } as const\n}\n\nexport const setTotalCount = (totalUsersCount: number) => {\n  return {\n    type: SET_TOTAL_COUNT,\n    count: totalUsersCount\n  } as const\n}\n\nexport const setIsFetching = (isFetching: boolean) => {\n  return {\n    type: TOGGLE_IS_FETCHING,\n    isFetching\n  } as const\n}\n\nexport const setIsFollowing = (followingInProgress: boolean, userId: number) => {\n  return {\n    type: TOGGLE_IS_FOLLOWING,\n    followingInProgress,\n    userId\n  } as const\n}\n\n\nexport const requestUser = (page: number, pageSize: number) => {\n  return async (dispatch: Dispatch) => {\n    dispatch(setCurrentPage(page));\n    dispatch(setIsFetching(true));\n\n    let response = await usersAPI.getUsersData(page, pageSize)\n\n    dispatch(setIsFetching(false));\n    dispatch(setUsers(response.items));\n    dispatch(setTotalCount(response.totalCount));\n  }\n}\n\nconst followUnfollowFlow = async (dispatch: Dispatch,\n                                  userId: number,\n                                  apiMethod: (userId: number) => Promise<ResponseUserType>,\n                                  actionCreator: (userId: number) => FollowType | UnFollowType) => {\n  dispatch(setIsFollowing(true, userId))\n\n  let response = await apiMethod(userId)\n\n  if (response.resultCode === 0) {\n    dispatch(actionCreator(userId))\n  }\n\n  dispatch(setIsFollowing(false, userId))\n}\n\nexport const unfollow = (userId: number) => {\n  return async (dispatch: Dispatch) => {\n    await followUnfollowFlow(dispatch, userId, usersAPI.unfollowUsers.bind(usersAPI), unfollowSuccess)\n  }\n}\n\nexport const follow = (userId: number) => {\n  return async (dispatch: Dispatch) => {\n    await followUnfollowFlow(dispatch, userId, usersAPI.followUsers.bind(usersAPI), followSuccess)\n  }\n}\n\n"]},"metadata":{},"sourceType":"module"}